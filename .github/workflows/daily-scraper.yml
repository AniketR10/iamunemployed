name: Daily Script Runner

on:
    schedule:
        - cron: '0 0 * * *'
    workflow_dispatch: 

jobs: 
    run-typescript:
        runs-on: ubuntu-latest

        steps:
             - name: Checkout Code
               uses: actions/checkout@v4

             - name: Setup Node.js
               uses: actions/setup-node@v4
               with:
                node-version: '20'
                cache: 'npm'

             - name: Setup Python
               uses: actions/setup-python@v4
               with:
                 python-version: '3.9'

             - name: Install Python Dependencies
               run: |
                 pip install feedparser beautifulsoup4 python-dotenv requests supabase praw

             - name: Install Node Dependencies
               run: npm ci

             - name: Run All Scripts
               env:
                NEXT_PUBLIC_SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
                SUPABASE_URL: ${{ secrets.NEXT_PUBLIC_SUPABASE_URL }}
                SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
                SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
                NEXT_PUBLIC_SUPABASE_ANON_KEY: ${{ secrets.NEXT_PUBLIC_SUPABASE_ANON_KEY }}
                
                GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
                OPENAI_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
                GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
                OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}
                REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
                REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
                REDDIT_USER_AGENT: ${{ secrets.REDDIT_USER_AGENT }}
                X_RAPIDAPI_KEY: ${{ secrets.X_RAPIDAPI_KEY }}
               
               run: npx tsx src/lib/runScripts.ts